<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets">
    <h:head>
        <title>Order Confirmation - Gaming Equipment Store</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
        <style>
            .checkout-container {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                padding: 2rem 0;
            }
            .checkout-card {
                background: white;
                border-radius: 15px;
                box-shadow: 0 20px 40px rgba(0,0,0,0.1);
                overflow: hidden;
            }
            .checkout-header {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 2rem;
                text-align: center;
            }
            .checkout-body {
                padding: 2rem;
            }
            .section-title {
                color: #333;
                font-weight: 600;
                margin-bottom: 1rem;
                padding-bottom: 0.5rem;
                border-bottom: 2px solid #e9ecef;
            }
            .order-info-card {
                background: #f8f9fa;
                border-radius: 10px;
                border: 1px solid #e9ecef;
            }
            .info-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem 0;
                border-bottom: 1px solid #e9ecef;
            }
            .info-item:last-child {
                border-bottom: none;
            }
            .info-label {
                font-weight: 600;
                color: #666;
                margin: 0;
            }
            .info-value {
                color: #333;
                font-weight: 500;
            }
            .total-amount {
                color: #e74c3c;
                font-weight: 700;
                font-size: 1.2em;
            }
            .status-pending {
                color: #f39c12;
                font-weight: 600;
            }
            .product-item {
                display: flex;
                align-items: center;
                padding: 1rem;
                border-bottom: 1px solid #e9ecef;
            }
            .product-item:last-child {
                border-bottom: none;
            }
            .product-image {
                width: 60px;
                height: 60px;
                object-fit: cover;
                border-radius: 8px;
                margin-right: 1rem;
            }
            .product-details {
                flex: 1;
            }
            .product-name {
                font-weight: 600;
                color: #333;
                margin-bottom: 0.25rem;
            }
            .product-price {
                color: #e74c3c;
                font-weight: 600;
            }
            .product-quantity {
                color: #666;
                font-size: 0.9em;
            }
            .form-control {
                border-radius: 8px;
                border: 2px solid #e9ecef;
                padding: 0.75rem;
                transition: all 0.3s ease;
            }
            .form-control:focus {
                border-color: #667eea;
                box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
            }
            .btn-confirm {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border: none;
                color: white;
                padding: 1rem 2rem;
                border-radius: 50px;
                font-weight: 600;
                font-size: 1.1em;
                transition: all 0.3s ease;
                width: 100%;
            }
            .btn-confirm:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
            }
        </style>
    </h:head>
    <h:body>
        <f:event type="preRenderView" listener="#{checkoutBean.init}" />

        <div class="checkout-container">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10">
                        <div class="checkout-card">
                            <!-- Header -->
                            <div class="checkout-header">
                                <h1><i class="fas fa-shopping-cart me-2"></i>Order Confirmation</h1>
                                <p class="mb-0">Please review your information and enter the shipping address</p>
                            </div>


                            <!-- Body -->
                            <div class="checkout-body">
                                <h:form>
                                    <!-- Order Information -->
                                    <div class="mb-4">
                                        <h4 class="section-title">
                                            <i class="fas fa-receipt me-2"></i>Order Information
                                        </h4>

                                        <div class="order-info-card p-4">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="info-item">
                                                        <label class="info-label">Order ID:</label>
                                                        <span class="info-value">#ORD#{checkoutBean.currentOrder.orderID}</span>
                                                    </div>
                                                    <div class="info-item">
                                                        <label class="info-label">Order Date:</label>
                                                        <span class="info-value">#{checkoutBean.currentOrder.orderDate}</span>
                                                    </div>
                                                    <div class="info-item">
                                                        <label class="info-label">Status:</label>
                                                        <span class="info-value status-pending">#{checkoutBean.getStatusDisplay(checkoutBean.currentOrder.status)}</span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="info-item">
                                                        <label class="info-label">Customer:</label>
                                                        <span class="info-value">#{checkoutBean.currentOrder.userID.fullName}</span>
                                                    </div>
                                                    <div class="info-item">
                                                        <label class="info-label">Email:</label>
                                                        <span class="info-value">#{checkoutBean.currentOrder.userID.email}</span>
                                                    </div>
                                                    <div class="info-item">
                                                        <label class="info-label">Total Amount:</label>
                                                        <span class="info-value total-amount">#{checkoutBean.formatPrice(checkoutBean.currentOrder.totalAmount)}$</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                    <!-- Products List -->
                                    <div class="mb-4">
                                        <h4 class="section-title">
                                            <i class="fas fa-box me-2"></i>Selected Products
                                        </h4>

                                        <div class="order-info-card">
                                            <h:dataTable value="#{checkoutBean.currentOrder.orderItemsCollection}" var="item" styleClass="table table-borderless mb-0">
                                                <h:column>
                                                    <div class="product-item">
                                                        <img src="asset/images/#{item.productID.image}" 
                                                             class="product-image" 
                                                             alt="#{item.productID.productName}" />
                                                        <div class="product-details">
                                                            <div class="product-name">#{item.productID.productName}</div>
                                                            <div class="product-quantity">Quantity: #{item.quantity}</div>
                                                        </div>
                                                        <div class="product-price">
                                                            #{checkoutBean.formatPrice(checkoutBean.getItemTotalPrice(item))}â‚«
                                                        </div>
                                                    </div>
                                                </h:column>
                                            </h:dataTable>
                                        </div>
                                    </div>

                                    <!-- Delivery Information -->
                                    <div class="mb-4">
                                        <h4 class="section-title">
                                            <i class="fas fa-truck me-2"></i>Shipping Information
                                        </h4>

                                        <div class="order-info-card p-4">
                                            <div class="form-group mb-3">
                                                <h:outputLabel value="Shipping Address:" styleClass="form-label fw-bold" />
                                                <h:inputTextarea value="#{checkoutBean.address}" 
                                                                 id="address"
                                                                 styleClass="form-control" 
                                                                 cols="50" 
                                                                 rows="3" 
                                                                 required="true"
                                                                 requiredMessage="Please enter the shipping address"
                                                                 onblur="validateAddress(this)"
                                                                 onkeyup="validateAddress(this)" />
                                                <h:message for="address" styleClass="text-danger" />
                                                <div id="address-error" class="text-danger" style="display: none; font-size: 0.875rem; margin-top: 5px;">
                                                    Please enter the shipping address
                                                </div>
                                            </div>

                                            <div class="form-group mb-3">
                                                <h:outputLabel value="Phone Number:" styleClass="form-label fw-bold" />
                                                <h:inputText value="#{checkoutBean.phone}" 
                                                             id="phone"
                                                             styleClass="form-control" 
                                                             required="true"
                                                             requiredMessage="Please enter your phone number"
                                                             onblur="validatePhone(this)"
                                                             onkeyup="validatePhone(this)" />
                                                <h:message for="phone" styleClass="text-danger" />
                                                <div id="phone-error" class="text-danger" style="display: none; font-size: 0.875rem; margin-top: 5px;">
                                                    Phone number must start with 0 and contain 9â€“11 digits
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                    <!-- Confirm Button -->
                                    <!-- Confirm Button -->
                                    <div class="text-center">
                                        <h:commandButton value="Confirm Order" 
                                                         action="#{checkoutBean.confirmOrder}"
                                                         styleClass="btn-confirm"
                                                         onclick="return confirmOrder()" />
                                    </div>


                                    <!-- JavaScript for validation and success alert -->
                                    <script>
                                        // Phone number validation
                                        function validatePhone(input) {
                                            const phone = input.value.trim();
                                            const phoneError = document.getElementById('phone-error');
                                            const phoneRegex = /^0[0-9]{8,10}$/; // Starts with 0, contains 9â€“11 digits

                                            if (phone === '') {
                                                phoneError.style.display = 'none';
                                                input.style.borderColor = '#e9ecef';
                                                return true;
                                            }

                                            if (!phoneRegex.test(phone)) {
                                                phoneError.style.display = 'block';
                                                input.style.borderColor = '#dc3545';
                                                input.style.borderWidth = '2px';
                                                return false;
                                            } else {
                                                phoneError.style.display = 'none';
                                                input.style.borderColor = '#28a745';
                                                input.style.borderWidth = '2px';
                                                return true;
                                            }
                                        }

                                        // Address validation
                                        function validateAddress(input) {
                                            const address = input.value.trim();

                                            if (address === '') {
                                                input.style.borderColor = '#e9ecef';
                                                return false;
                                            } else {
                                                input.style.borderColor = '#28a745';
                                                input.style.borderWidth = '2px';
                                                return true;
                                            }
                                        }

                                        function confirmOrder() {
                                            const phoneInput = document.getElementById('phone');
                                            const addressInput = document.getElementById('address');

                                            // Validate phone
                                            const isPhoneValid = validatePhone(phoneInput);

                                            // Validate address
                                            const isAddressValid = validateAddress(addressInput);

                                            if (!isPhoneValid || !isAddressValid) {
                                                alert('Please check your shipping address and phone number!');
                                                return false;
                                            }

                                            // Show confirmation popup before submitting
                                            if (confirm('Are you sure you want to place the order?')) {
                                                return true;
                                            }
                                            return false;
                                        }

                                        // Check for success message from server
                                        window.onload = function () {
                                            // Check URL parameters to display success alert
                                            const urlParams = new URLSearchParams(window.location.search);
                                            if (urlParams.get('success') === 'true') {
                                                alert('ðŸŽ‰ ORDER SUCCESSFUL! ðŸŽ‰\n\nThank you for shopping with us!');
                                            }
                                        };
                                    </script>

                                </h:form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </h:body>
</html>
